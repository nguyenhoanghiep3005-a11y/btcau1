<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n L√Ω Sinh Vi√™n Pro - MongoDB & Vercel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 50px;
        }

        .card {
            border: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="card p-4">
            <h2 class="text-center text-primary mb-4">üéì QU·∫¢N L√ù SINH VI√äN CHUY√äN NGHI·ªÜP</h2>

            <div class="row mb-3">
                <div class="col-md-8">
                    <div class="input-group">
                        <span class="input-group-text bg-white">üîç</span>
                        <input type="text" id="search" class="form-control" placeholder="T√¨m ki·∫øm t√™n ho·∫∑c MSSV..."
                            onkeyup="search()">
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <span class="badge bg-primary fs-6">T·ªïng: <span id="count">0</span></span>
                </div>
            </div>

            <div class="row g-2 mb-4">
                <div class="col-md-3"><input type="text" id="name" class="form-control" placeholder="H·ªç T√™n"></div>
                <div class="col-md-3"><input type="text" id="mssv" class="form-control" placeholder="MSSV"></div>
                <div class="col-md-3"><input type="text" id="class" class="form-control" placeholder="L·ªõp"></div>
                <div class="col-md-3"><button class="btn btn-success w-100" onclick="addStudent()">+ TH√äM M·ªöI</button>
                </div>
            </div>

            <table class="table table-hover">
                <thead class="table-primary">
                    <tr>
                        <th>H·ªç T√™n</th>
                        <th>MSSV</th>
                        <th>L·ªõp</th>
                        <th class="text-center">H√†nh ƒê·ªông</th>
                    </tr>
                </thead>
                <tbody id="result"></tbody>
            </table>
        </div>
    </div>

    <script>
        const API = '/api/students';
        let list = [];

        async function load() {
            const res = await fetch(API);
            list = await res.json();
            render(list);
        }

        function render(data) {
            document.getElementById('count').innerText = data.length;
            document.getElementById('result').innerHTML = data.map(s => `
                <tr>
                    <td>${s.name}</td>
                    <td>${s.mssv}</td>
                    <td>${s.class_name}</td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-warning me-1" onclick="edit('${s.id}','${s.name}','${s.mssv}','${s.class_name}')">S·ª≠a</button>
                        <button class="btn btn-sm btn-danger" onclick="del('${s.id}')">X√≥a</button>
                    </td>
                </tr>
            `).join('');
        }

        async function addStudent() {
    const name = document.getElementById('name').value;
    const mssv = document.getElementById('mssv').value;
    const class_name = document.getElementById('class').value; // L·∫•y ƒë√∫ng ID 'class'
    
    if (!name || !mssv) return alert("Nh·∫≠p ƒë·ªß t√™n v√† MSSV!");

    // S·ª≠a l·∫°i API: B·ªè ƒëu√¥i .js
    await fetch('/api/students', { 
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, mssv, class_name })
    });
    
    document.querySelectorAll('input').forEach(i => i.value = '');
    load();
}

        async function del(id) {
            if (confirm("X√≥a sinh vi√™n n√†y?")) {
                await fetch(`${API}?id=${id}`, { method: 'DELETE' });
                load();
            }
        }

        async function edit(id, n, m, c) {
            const name = prompt("T√™n m·ªõi:", n);
            if (name) {
                await fetch(API, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id, name, mssv: m, class_name: c })
                });
                load();
            }
        }

        function search() {
            const t = document.getElementById('search').value.toLowerCase();
            render(list.filter(s => s.name.toLowerCase().includes(t) || s.mssv.includes(t)));
        }

        load();
    </script>
</body>

</html>